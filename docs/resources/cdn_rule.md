---
subcategory: "Cloud Content Delivery Network (CDN)"
page_title: "Yandex: yandex_cdn_rule"
description: |-
  Manages a Yandex CDN Resource Rule.
---

# yandex_cdn_rule (Resource)

Manages a CDN Rule. CDN Rules allow you to apply different CDN settings based on URL patterns.

Rules with lower weight values are executed first.

## Example usage

```terraform
//
// Create a new CDN Rule
//
resource "yandex_cdn_rule" "my_rule" {
  resource_id  = yandex_cdn_resource.my_resource.id
  name         = "images-rule"
  rule_pattern = "/images/.*"
  weight       = 100

  options {
    edge_cache_settings {
      enabled    = true
      cache_time = {
        "*" = 86400
      }
    }

    browser_cache_settings {
      enabled    = true
      cache_time = 3600
    }

    gzip_on = true
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Rule name (max 50 characters).
- `resource_id` (String) CDN Resource ID to attach the rule to.
- `rule_pattern` (String) Rule pattern - must be a valid regular expression (max 100 characters).

### Optional

- `options` (Block List) CDN Resource settings and options to tune CDN edge behavior. (see [below for nested schema](#nestedblock--options))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `weight` (Number) Rule weight (0-9999) - rules with lower weights execute first. Default: `0`.

### Read-Only

- `id` (String) The ID of the CDN rule in the format `resource_id/rule_id`.
- `rule_id` (String) Rule ID (stored as string to avoid int64 precision loss).

<a id="nestedblock--options"></a>
### Nested Schema for `options`

Optional:

- `allowed_http_methods` (List of String) HTTP methods for your CDN content. By default the following methods are allowed: GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS. In case some methods are not allowed to the user, they will get the 405 (Method Not Allowed) response. If the method is not supported, the user gets the 501 (Not Implemented) response.
- `browser_cache_settings` (Block List) Set up a cache period for the end-users browser. Content will be cached due to origin settings. If there are no cache settings on your origin, the content will not be cached. The list of HTTP response codes that can be cached in browsers: 200, 201, 204, 206, 301, 302, 303, 304, 307, 308. Other response codes will not be cached. The default value is 4 days. **By default, browser caching is enabled in Yandex CDN.** To explicitly disable it, set `enabled = false` (provider will send `cache_time = 0` to API). Alternatively, you can set `enabled = true` with `cache_time = 0`. To remove the configuration entirely, omit this block. (see [below for nested schema](#nestedblock--options--browser_cache_settings))
- `cache_http_headers` (List of String) List HTTP headers that must be included in responses to clients.
- `cors` (List of String) Parameter that lets browsers get access to selected resources from a domain different to a domain from which the request is received.
- `custom_host_header` (String) Custom value for the Host header. Your server must be able to process requests with the chosen header.
- `custom_server_name` (String) Wildcard additional CNAME. If a resource has a wildcard additional CNAME, you can use your own certificate for content delivery via HTTPS.
- `disable_proxy_force_ranges` (Boolean) Disabling proxy force ranges.
- `edge_cache_settings` (Block List) Content will be cached according to origin cache settings. Use either `default_value` for simple caching or `custom_values` for per-HTTP-code caching. The value applies for response codes 200, 201, 204, 206, 301, 302, 303, 304, 307, 308 if origin server does not have caching HTTP headers. **By default, edge caching is enabled in Yandex CDN.** To explicitly disable it, set `enabled = false` (provider will send `cache_time = 0` to API). Alternatively, you can set `enabled = true` with `cache_time = {"*" = 0}`. To remove the configuration entirely, omit this block. (see [below for nested schema](#nestedblock--options--edge_cache_settings))
- `enable_ip_url_signing` (Boolean) Enable access limiting by IP addresses, option available only with setting secure_key.
- `fetched_compressed` (Boolean) Option helps you to reduce the bandwidth between origin and CDN servers. Also, content delivery speed becomes higher because of reducing the time for compressing files in a CDN.
- `forward_host_header` (Boolean) Choose the Forward Host header option if is important to send in the request to the Origin the same Host header as was sent in the request to CDN server.
- `gzip_on` (Boolean) GZip compression at CDN servers reduces file size by 70% and can be as high as 90%.
- `ignore_cookie` (Boolean) Set for ignoring cookie.
- `ignore_query_params` (Boolean) Files with different query parameters are cached as objects with the same key regardless of the parameter value. selected by default.
- `ip_address_acl` (Block List) IP address access control list. The list of specified IP addresses to be allowed or denied depending on acl policy type. (see [below for nested schema](#nestedblock--options--ip_address_acl))
- `proxy_cache_methods_set` (Boolean) Allows caching for GET, HEAD and POST requests.
- `query_params_blacklist` (List of String) Files with the specified query parameters are cached as objects with the same key, files with other parameters are cached as objects with different keys.
- `query_params_whitelist` (List of String) Files with the specified query parameters are cached as objects with different keys, files with other parameters are cached as objects with the same key.
- `redirect_http_to_https` (Boolean) Set up a redirect from HTTP to HTTPS.
- `redirect_https_to_http` (Boolean) Set up a redirect from HTTPS to HTTP.
- `rewrite` (Block List) An option for changing or redirecting query paths. (see [below for nested schema](#nestedblock--options--rewrite))
- `secure_key` (String, Sensitive) Set secure key for url encoding to protect content and limit access by IP addresses and time limits.
- `slice` (Boolean) Files larger than 10 MB will be requested and cached in parts (no larger than 10 MB each part). It reduces time to first byte. The origin must support HTTP Range requests.
- `static_request_headers` (Map of String) Set up custom headers that CDN servers will send in requests to origins.
- `static_response_headers` (Map of String) Set up a static response header. The header name must be lowercase.

<a id="nestedblock--options--browser_cache_settings"></a>
### Nested Schema for `options.browser_cache_settings`

Optional:

- `cache_time` (Number) Cache time in seconds for browsers. Must be between 0 and 31536000 (1 year). Use `0` to explicitly disable caching. Required when `enabled = true`, must not be set when `enabled = false`.
- `enabled` (Boolean) True - browser caching is enabled with `cache_time` setting. False - browser caching is disabled (provider sends `cache_time = 0` to API). Use `enabled = false` to explicitly disable browser caching (which is enabled by default in Yandex CDN). Cannot be used together with `cache_time`.


<a id="nestedblock--options--edge_cache_settings"></a>
### Nested Schema for `options.edge_cache_settings`

Optional:

- `cache_time` (Map of Number) Cache time in seconds. Use `"*"` as key for default cache time for all HTTP codes (200, 201, 204, 206, 301, 302, 303, 304, 307, 308), or specify cache times per HTTP code (e.g., `{"200" = 3600, "404" = 300}`). Use `{"*" = 0}` to explicitly disable caching. Required when `enabled = true`, must not be set when `enabled = false`.
- `enabled` (Boolean) True - caching is enabled with `cache_time` settings. False - caching is disabled (provider sends `cache_time = 0` to API). Use `enabled = false` to explicitly disable edge caching (which is enabled by default in Yandex CDN). Cannot be used together with `cache_time`.


<a id="nestedblock--options--ip_address_acl"></a>
### Nested Schema for `options.ip_address_acl`

Required:

- `excepted_values` (List of String) The list of specified IP addresses to be allowed or denied depending on acl policy type.
- `policy_type` (String) The policy type for ACL. One of `allow` or `deny` values.


<a id="nestedblock--options--rewrite"></a>
### Nested Schema for `options.rewrite`

Required:

- `body` (String) Pattern for rewrite. The value must have the following format: `<source path> <destination path>`, where both paths are regular expressions which use at least one group. E.g., `/foo/(.*) /bar/$1`.

Optional:

- `enabled` (Boolean) True - the rewrite option is enabled and its flag is applied to the resource. False - the rewrite option is disabled. Default is false.
- `flag` (String) Rewrite flag. Available values: 'last', 'break', 'redirect', 'permanent'. Default is 'break'.



<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).
- `delete` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Setting a timeout for a Delete operation is only applicable if changes are saved into state before the destroy operation occurs.
- `read` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours). Read operations occur during any refresh or planning operation when refresh is enabled.
- `update` (String) A string that can be [parsed as a duration](https://pkg.go.dev/time#ParseDuration) consisting of numbers and unit suffixes, such as "30s" or "2h45m". Valid time units are "s" (seconds), "m" (minutes), "h" (hours).

## Import

CDN rules can be imported using the composite ID in the format `resource_id/rule_id`, e.g.:

```shell
terraform import yandex_cdn_rule.my_rule bc851ft45fne********/123456
```
