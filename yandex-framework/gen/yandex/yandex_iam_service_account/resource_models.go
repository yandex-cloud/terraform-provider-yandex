// Code generated by tfgen. DO NOT EDIT.

package yandex_iam_service_account

import (
	"context"
	"time"

	"github.com/hashicorp/terraform-plugin-framework-timeouts/resource/timeouts"
	"github.com/hashicorp/terraform-plugin-framework/attr"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/hashicorp/terraform-plugin-framework/types/basetypes"
	iam "github.com/yandex-cloud/go-genproto/yandex/cloud/iam/v1"
	"github.com/yandex-cloud/terraform-provider-yandex/pkg/converter"
)

type yandexIAMServiceAccountModel struct {
	CreatedAt        types.String   `tfsdk:"created_at"`
	Description      types.String   `tfsdk:"description"`
	FolderId         types.String   `tfsdk:"folder_id"`
	Labels           types.Map      `tfsdk:"labels"`
	Name             types.String   `tfsdk:"name"`
	ServiceAccountId types.String   `tfsdk:"service_account_id"`
	ID               types.String   `tfsdk:"id"`
	Timeouts         timeouts.Value `tfsdk:"timeouts"`
}

func (m *yandexIAMServiceAccountModel) GetCreatedAt() types.String {
	return m.CreatedAt
}
func (m *yandexIAMServiceAccountModel) GetDescription() types.String {
	return m.Description
}
func (m *yandexIAMServiceAccountModel) GetFolderId() types.String {
	return m.FolderId
}
func (m *yandexIAMServiceAccountModel) GetLabels() types.Map {
	return m.Labels
}
func (m *yandexIAMServiceAccountModel) GetName() types.String {
	return m.Name
}
func (m *yandexIAMServiceAccountModel) GetServiceAccountId() types.String {
	return m.ServiceAccountId
}
func (m *yandexIAMServiceAccountModel) GetID() types.String {
	return m.ID
}

func NewYandexIAMServiceAccountModel() yandexIAMServiceAccountModel {
	return yandexIAMServiceAccountModel{
		CreatedAt:        types.StringNull(),
		Description:      types.StringNull(),
		FolderId:         types.StringNull(),
		Labels:           types.MapNull(types.StringType),
		Name:             types.StringNull(),
		ServiceAccountId: types.StringNull(),
		ID:               types.StringNull(),
	}
}

func yandexIAMServiceAccountModelFillUnknown(target yandexIAMServiceAccountModel) yandexIAMServiceAccountModel {
	if target.CreatedAt.IsUnknown() || target.CreatedAt.IsNull() {
		target.CreatedAt = types.StringNull()
	}
	if target.Description.IsUnknown() || target.Description.IsNull() {
		target.Description = types.StringNull()
	}
	if target.FolderId.IsUnknown() || target.FolderId.IsNull() {
		target.FolderId = types.StringNull()
	}
	if target.Labels.IsUnknown() || target.Labels.IsNull() {
		target.Labels = types.MapNull(types.StringType)
	}
	if target.Name.IsUnknown() || target.Name.IsNull() {
		target.Name = types.StringNull()
	}
	if target.ServiceAccountId.IsUnknown() || target.ServiceAccountId.IsNull() {
		target.ServiceAccountId = types.StringNull()
	}
	if target.ID.IsUnknown() || target.ID.IsNull() {
		target.ID = types.StringNull()
	}
	return target
}

var yandexIAMServiceAccountModelType = types.ObjectType{
	AttrTypes: map[string]attr.Type{
		"created_at":         types.StringType,
		"description":        types.StringType,
		"folder_id":          types.StringType,
		"labels":             types.MapType{ElemType: types.StringType},
		"name":               types.StringType,
		"service_account_id": types.StringType,
		"id":                 types.StringType,
		"timeouts":           timeouts.BlockAll(context.Background()).Type(),
	},
}

func flattenYandexIAMServiceAccount(ctx context.Context,
	yandexIAMServiceAccount *iam.ServiceAccount,
	state yandexIAMServiceAccountModel,
	to timeouts.Value,
	diags *diag.Diagnostics) types.Object {
	if yandexIAMServiceAccount == nil {
		return types.ObjectNull(yandexIAMServiceAccountModelType.AttrTypes)
	}
	value, diag := types.ObjectValueFrom(ctx, yandexIAMServiceAccountModelType.AttrTypes, yandexIAMServiceAccountModel{
		CreatedAt:        types.StringValue(yandexIAMServiceAccount.GetCreatedAt().AsTime().Format(time.RFC3339)),
		Description:      types.StringValue(yandexIAMServiceAccount.GetDescription()),
		FolderId:         types.StringValue(yandexIAMServiceAccount.GetFolderId()),
		Labels:           flattenYandexIAMServiceAccountLabels(ctx, yandexIAMServiceAccount.GetLabels(), state.Labels, diags),
		Name:             types.StringValue(yandexIAMServiceAccount.GetName()),
		ServiceAccountId: types.StringValue(yandexIAMServiceAccount.GetId()),
		ID:               types.StringValue(yandexIAMServiceAccount.GetId()),
		Timeouts:         to,
	})
	diags.Append(diag...)
	return value
}

func expandYandexIAMServiceAccount(ctx context.Context, yandexIAMServiceAccountState types.Object, diags *diag.Diagnostics) *iam.ServiceAccount {
	if yandexIAMServiceAccountState.IsNull() || yandexIAMServiceAccountState.IsUnknown() {
		return nil
	}
	var yandexIAMServiceAccount yandexIAMServiceAccountModel
	diags.Append(yandexIAMServiceAccountState.As(ctx, &yandexIAMServiceAccount, basetypes.ObjectAsOptions{UnhandledNullAsEmpty: true, UnhandledUnknownAsEmpty: true})...)
	if diags.HasError() {
		return nil
	}
	return expandYandexIAMServiceAccountModel(ctx, yandexIAMServiceAccount, diags)
}

func expandYandexIAMServiceAccountModel(ctx context.Context, yandexIAMServiceAccountState yandexIAMServiceAccountModel, diags *diag.Diagnostics) *iam.ServiceAccount {
	value := &iam.ServiceAccount{}
	value.SetCreatedAt(converter.ParseTimestamp(yandexIAMServiceAccountState.CreatedAt.ValueString(), diags))
	value.SetDescription(yandexIAMServiceAccountState.Description.ValueString())
	value.SetFolderId(yandexIAMServiceAccountState.FolderId.ValueString())
	value.SetLabels(expandYandexIAMServiceAccountLabels(ctx, yandexIAMServiceAccountState.Labels, diags))
	value.SetName(yandexIAMServiceAccountState.Name.ValueString())
	value.SetId(yandexIAMServiceAccountState.ServiceAccountId.ValueString())
	value.SetId(yandexIAMServiceAccountState.ServiceAccountId.ValueString())
	if diags.HasError() {
		return nil
	}
	return value
}

func flattenYandexIAMServiceAccountLabels(ctx context.Context, yandexIAMServiceAccountLabels map[string]string, listState types.Map, diags *diag.Diagnostics) types.Map {
	if yandexIAMServiceAccountLabels == nil {
		if !listState.IsNull() && !listState.IsUnknown() && len(listState.Elements()) == 0 {
			return listState
		}
		return types.MapNull(types.StringType)
	}
	yandexIAMServiceAccountLabelsValues := make(map[string]attr.Value)
	for k, elem := range yandexIAMServiceAccountLabels {
		val := types.StringValue(elem)
		yandexIAMServiceAccountLabelsValues[k] = val
	}

	value, diag := types.MapValue(types.StringType, yandexIAMServiceAccountLabelsValues)
	diags.Append(diag...)
	return value
}

func expandYandexIAMServiceAccountLabels(ctx context.Context, yandexIAMServiceAccountLabelsState types.Map, diags *diag.Diagnostics) map[string]string {
	if yandexIAMServiceAccountLabelsState.IsNull() || yandexIAMServiceAccountLabelsState.IsUnknown() {
		return nil
	}
	if len(yandexIAMServiceAccountLabelsState.Elements()) == 0 {
		return map[string]string{}
	}
	yandexIAMServiceAccountLabelsRes := make(map[string]string)
	yandexIAMServiceAccountLabelsType := make(map[string]types.String)
	diags.Append(yandexIAMServiceAccountLabelsState.ElementsAs(ctx, &yandexIAMServiceAccountLabelsType, false)...)
	if diags.HasError() {
		return nil
	}
	for k, elem := range yandexIAMServiceAccountLabelsType {
		yandexIAMServiceAccountLabelsRes[k] = elem.ValueString()
	}
	return yandexIAMServiceAccountLabelsRes
}
